generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("PRISMA_DATABASE_USER_URL")
}

enum LanguageLevel {
    A0
    A1
    A2
    B1
    B2
    C1
    C2
    NATIVE
}

model User {
    id      String @id @map("id")
    email   String @unique @map("email")
    name    String @map("name")
    surname String @map("surname")
    role    String @map("role")

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    languages    UserLanguage[]
    achievements UserAchievement[]
    aiTokens     UserAIToken[]
    materials    UserMaterial[]

    @@map("users")
}

model Language {
    id           String         @id @default(uuid()) @map("id")
    name         String         @map("name")
    code         String         @unique @map("code")
    tasks        Task[]
    UserLanguage UserLanguage[]

    @@map("languages")
}

model UserLanguage {
    id         String   @id @default(uuid()) @map("id")
    userId     String   @map("user_id")
    languageId String   @map("language_id")
    createdAt  DateTime @default(now()) @map("created_at")
    updatedAt  DateTime @updatedAt @map("updated_at")
    level      String   @map("level")
    isStarted  Boolean  @map("is_started")
    isNative   Boolean  @map("is_native")
    user       User     @relation(fields: [userId], references: [id])
    language   Language @relation(fields: [languageId], references: [id])

    @@map("user_languages")
}

model UserAIToken {
    id           String     @id @default(uuid()) @map("id")
    userId       String     @map("user_id")
    token        String     @map("token")
    aiProviderId String     @map("ai_provider_id")
    createdAt    DateTime   @default(now()) @map("created_at")
    updatedAt    DateTime   @updatedAt @map("updated_at")
    user         User       @relation(fields: [userId], references: [id])
    aiProvider   AIProvider @relation(fields: [aiProviderId], references: [id])
    isDefault    Boolean    @default(false) @map("is_default")

    @@map("user_ai_tokens")
}

model Task {
    id         String   @id @default(uuid()) @map("id")
    name       String   @map("name")
    languageId String   @map("language_id")
    language   Language @relation(fields: [languageId], references: [id])

    @@map("tasks")
}

model Achievement {
    id              String            @id @default(uuid()) @map("id")
    name            String            @map("name")
    description     String            @map("description")
    imageUrl        String            @map("image_url")
    UserAchievement UserAchievement[]

    @@map("achievements")
}

model UserAchievement {
    id            String      @id @default(uuid()) @map("id")
    userId        String      @map("user_id")
    achievementId String      @map("achievement_id")
    user          User        @relation(fields: [userId], references: [id])
    achievement   Achievement @relation(fields: [achievementId], references: [id])

    @@map("user_achievements")
}

model AIProvider {
    id           String        @id @default(uuid()) @map("id")
    name         String        @unique @map("name")
    userAITokens UserAIToken[]

    @@map("ai_providers")
}

model UserMaterial {
    id            String   @id @default(uuid()) @map("id")
    userId        String   @map("user_id")
    filename      String   @map("filename")
    analyzedTypes Json     @map("analyzed_types")
    createdAt     DateTime @default(now()) @map("created_at")
    user          User     @relation(fields: [userId], references: [id])

    @@map("user_materials")
}
